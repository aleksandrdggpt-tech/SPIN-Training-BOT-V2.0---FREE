#!/bin/bash

echo "üîÅ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ SPIN Training Bot..."

# --- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∫–∞–∫ –≤ stop_bot.sh) ---
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é SPIN Training Bot..."
echo "üîç –ü–æ–∏—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞..."
# –ü–µ—Ä–µ—á–µ–Ω—å –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∑–∞–ø—É—Å–∫–∞ (python/python3, venv, –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏)
PIDS=$(pgrep -f "[p]ython.*bot.py" || true)
if [ -n "$PIDS" ]; then
  echo "–ù–∞–π–¥–µ–Ω—ã PID: $PIDS"
  echo "üíÄ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –ø—Ä–æ—Ü–µ—Å—Å—ã (TERM)..."
  pkill -f "[p]ython.*bot.py" || true
  sleep 1
  # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  PIDS2=$(pgrep -f "[p]ython.*bot.py" || true)
  if [ -n "$PIDS2" ]; then
    echo "‚ö†Ô∏è  –í—Å—ë –µ—â—ë –∑–∞–ø—É—â–µ–Ω—ã: $PIDS2 ‚Äî –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é (KILL)..."
    pkill -9 -f "[p]ython.*bot.py" || true
    sleep 1
  fi
else
  echo "–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –±–æ—Ç–∞."
fi

# --- –ó–∞–ø—É—Å–∫ ---
echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é –±–æ—Ç–∞..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$SCRIPT_DIR" || exit 1

# –í—ã–±–∏—Ä–∞–µ–º –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä (–µ—Å–ª–∏ –µ—Å—Ç—å venv ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ)
PY_BIN="python3"
if [ -x "venv/bin/python3" ]; then
  PY_BIN="venv/bin/python3"
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤ –ü–ï–†–ï–î–ù–ï–ú –ø–ª–∞–Ω–µ (–ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª)
echo "üìú –õ–æ–≥–∏ –±—É–¥—É—Ç –≤—ã–≤–µ–¥–µ–Ω—ã –≤ —ç—Ç–æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª. –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏."
exec "$PY_BIN" bot.py


